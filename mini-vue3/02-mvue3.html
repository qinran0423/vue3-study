<div id="app">
	<h3>{{title}}</h3>
</div>

<script>
	const Vue = {
		createApp(options) {
			return {
				mount(selector) {
					const parent = document.querySelector(selector);

					if(!options.render) {
						options.render = this.complie(parent.innerHTML);
					}
					
					// 兼容options api
					if (options.setup) {
						this.setupstate = options.setup()
					} else {
						this.data = options.data()
					}

					this.proxy = new Proxy(this, {
						get(target, key) {
							if(key in target.setupstate) {
								return target.setupstate[key]
							} else {
								return target.data[key]
							}
						},
						set(target, key, val) {
							if(key in target.setupstate) {
								target.setupstate[key] = val
							} else {
								target.data[key] = val
							}
						}
					})

					const el = options.render.call(this.proxy)

					parent.innerHTML = '';
					parent.appendChild(el);
					
				},
				complie(template) {
					return function render() {
						const h3 = document.createElement('h3');
						h3.textContent =  this.title;
						return h3;
					}
				}
			}
		}
	}
</script>

<script>
	// 1.函数式方式获取实例 : 类型的支持会更好，迎合ts
	// 2. 简化、标准化、一致性: render函数，sync修饰符删除，指令定义，v-model调整
	// 3. tree-shaking
	// 4. 复用性：composition api
	// 5. 性能优化： 响应式、编译期优化
	// 6. 扩展性：自定义渲染器
	const {
		createApp,
		reactive
	} = Vue
	const app = createApp({
		data() {
			return {
				title: 'hello, vue3!'
			}
		},
		setup() {
			return {
				title: 'hello, vue3!!!!!!'
			}
		}
	})

	app.mount('#app')
</script>